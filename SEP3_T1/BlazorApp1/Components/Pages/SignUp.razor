@page "/SignUp"
@using System.ComponentModel.DataAnnotations
@using ApiContract
@using BlazorApp1.Services
@inject ICustomerService CustomerService
<PageTitle>Sign up</PageTitle>

<div class="card mb-4">
    <div class="card-header">Sign up</div>
    <div class="card-body">
        <EditForm Model="newCustomer" OnValidSubmit="SaveCustomerAsync" FormName="SignUpForm">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            
            <div class="mb-3">
                <label class="form-label">Name:</label>
                <InputText @bind-Value="newCustomer.Name" class="form-control"/>
                <ValidationMessage For="() => newCustomer.Name"/>
            </div>

            <div class="mb-3">
                <label class="form-label">Phone number:</label>
                <InputText @bind-Value="newCustomer.Phone" class="form-control"/>
                <ValidationMessage For="() => newCustomer.Phone"/>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Email:</label>
                <InputText @bind-Value="newCustomer.Email" class="form-control"/>
                <ValidationMessage For="() => newCustomer.Email"/>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Password:</label>
                <InputText @bind-Value="newCustomer.Password" class="form-control"/>
                <ValidationMessage For="() => newCustomer.Password"/>
            </div>
            
            <button class="btn btn-success" disabled="@isBusy" OnClick="@SaveCustomerAsync" FormName="SignUpForm">Sign Up</button>
        </EditForm>
        
        <label></label>
    </div>
</div>

@code
{
    private CreateCustomerFromModel newCustomer = new();
    private bool isBusy;

    private class CreateCustomerFromModel
    {
        
        public string Phone { get; set; }
        
        
        public string? Name { get; set; }
        
        
        public string? Email { get; set; }
        
        
        public string? Password { get; set; }
    }
    
    private async Task SaveCustomerAsync()
    {
         // to ensure phone is numeric
        isBusy = true;
        try
        {
            SaveCustomerDto customerDto = new SaveCustomerDto 
            (
                Phone: int.TryParse( newCustomer.Phone!),
                Name: newCustomer.Name!,
                Email: newCustomer.Email!,
                Password: newCustomer.Password!
            );

            await CustomerService.SaveCustomerAsync(customerDto);
        }
        finally
        {
            isBusy = false;
        }
    }
    
}
